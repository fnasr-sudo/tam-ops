<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tam Ops — Command Center</title>
<style>
  :root { --bg: #0d1117; --card: #161b22; --border: #30363d; --text: #e6edf3; --dim: #8b949e; --green: #3fb950; --red: #f85149; --blue: #58a6ff; --yellow: #d29922; }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { font-family: -apple-system, system-ui, sans-serif; background: var(--bg); color: var(--text); padding-bottom: 40px; }
  
  .header { background: var(--card); border-bottom: 1px solid var(--border); padding: 16px 20px; position: sticky; top: 0; z-index: 100; display: flex; justify-content: space-between; align-items: center; }
  .header h1 { font-size: 20px; font-weight: 700; }
  .live-indicator { display: flex; align-items: center; gap: 8px; font-size: 12px; color: var(--green); }
  .dot { width: 8px; height: 8px; background: var(--green); border-radius: 50%; animation: pulse 2s infinite; }
  @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.4; } 100% { opacity: 1; } }

  .container { max-width: 1200px; margin: 0 auto; padding: 20px; }

  /* Stats Grid */
  .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px; margin-bottom: 24px; }
  .stat-card { background: var(--card); border: 1px solid var(--border); padding: 16px; border-radius: 8px; }
  .stat-label { font-size: 11px; text-transform: uppercase; color: var(--dim); margin-bottom: 4px; }
  .stat-val { font-size: 24px; font-weight: 700; }
  .green { color: var(--green); } .red { color: var(--red); } .blue { color: var(--blue); } .yellow { color: var(--yellow); }

  /* Active Setups */
  .section-title { font-size: 16px; font-weight: 600; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }
  .setup-card { background: var(--card); border: 1px solid var(--border); border-radius: 8px; overflow: hidden; margin-bottom: 16px; }
  .setup-header { padding: 16px; background: rgba(255,255,255,0.03); border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
  .pair-info { display: flex; align-items: center; gap: 12px; }
  .pair-name { font-size: 18px; font-weight: 700; }
  .badge { font-size: 11px; padding: 2px 8px; border-radius: 12px; font-weight: 600; text-transform: uppercase; }
  .bg-green { background: rgba(63,185,80,0.15); color: var(--green); }
  .bg-red { background: rgba(248,81,73,0.15); color: var(--red); }
  .bg-blue { background: rgba(88,166,255,0.15); color: var(--blue); }

  .setup-body { padding: 16px; }
  .setup-meta { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 16px; margin-bottom: 20px; }
  .meta-item label { font-size: 11px; color: var(--dim); display: block; margin-bottom: 4px; }
  .meta-item val { font-size: 15px; font-weight: 600; }

  /* Grid Levels Table */
  .grid-table { width: 100%; border-collapse: collapse; font-size: 13px; }
  .grid-table th { text-align: left; color: var(--dim); padding: 8px; border-bottom: 1px solid var(--border); font-weight: 500; }
  .grid-table td { padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.05); }
  .grid-table tr:last-child td { border-bottom: none; }
  .level-name { font-weight: 600; color: var(--blue); }
  .profit-col { text-align: right; font-family: monospace; font-size: 14px; }
  .status-col { text-align: center; }

  .expected-row { background: rgba(63,185,80,0.05); font-weight: 600; }
  
  @media (max-width: 600px) {
    .setup-header { flex-direction: column; align-items: flex-start; gap: 8px; }
    .grid-table th:nth-child(3), .grid-table td:nth-child(3) { display: none; } /* Hide TP on mobile */
  }
</style>
</head>
<body>

<div class="header">
  <h1>Tam<span>Ops</span> Command Center</h1>
  <div class="live-indicator"><div class="dot"></div> LIVE</div>
</div>

<div class="container">
  
  <!-- Top Stats -->
  <div class="stats">
    <div class="stat-card">
      <div class="stat-label">Daily Realized P&L</div>
      <div class="stat-val" id="daily-pnl">$0.00</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">Potential Profit (Active)</div>
      <div class="stat-val green" id="potential-pnl">$0.00</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">Win Rate</div>
      <div class="stat-val yellow" id="win-rate">—</div>
    </div>
  </div>

  <div class="section-title">⚡ Active Operations</div>
  <div id="setups-container">
    <!-- Setups injected here -->
  </div>

</div>

<script>
async function loadData() {
  try {
    const res = await fetch('trades.json?t=' + Date.now());
    const data = await res.json();
    render(data);
  } catch (e) { console.error("Fetch error", e); }
}

function render(data) {
  // Stats
  document.getElementById('daily-pnl').textContent = `$${(data.stats.dailyPnl || 0).toFixed(2)}`;
  document.getElementById('daily-pnl').className = `stat-val ${data.stats.dailyPnl >= 0 ? 'green' : 'red'}`;
  
  document.getElementById('potential-pnl').textContent = `$${(data.stats.potentialPnl || 0).toFixed(2)}`;
  
  // Setups
  const container = document.getElementById('setups-container');
  container.innerHTML = '';

  if (!data.setups || data.setups.length === 0) {
    container.innerHTML = '<div style="padding:40px; text-align:center; color:#8b949e">No active operations.</div>';
    return;
  }

  data.setups.forEach(setup => {
    const dirClass = setup.direction === 'BUY' ? 'bg-green' : 'bg-red';
    
    // Grid Levels HTML
    const levelsHtml = setup.levels.map(lvl => `
      <tr>
        <td class="level-name">${lvl.name}</td>
        <td>${lvl.vol} @ ${lvl.price}</td>
        <td>TP: ${lvl.tp}</td>
        <td class="status-col"><span class="badge bg-blue">${lvl.status}</span></td>
        <td class="profit-col green">+$${lvl.expectedProfit.toFixed(2)}</td>
      </tr>
    `).join('');

    const card = `
      <div class="setup-card">
        <div class="setup-header">
          <div class="pair-info">
            <div class="pair-name">${setup.pair}</div>
            <span class="badge ${dirClass}">${setup.direction}</span>
            <span class="badge bg-blue">${setup.strategy}</span>
          </div>
          <div style="font-size:13px; color:var(--dim)">${setup.distanceToOrigin || 'At Market'}</div>
        </div>
        
        <div class="setup-body">
          <div class="setup-meta">
            <div class="meta-item"><label>Origin</label><val>${setup.origin}</val></div>
            <div class="meta-item"><label>Total Size</label><val>${setup.baseLot}</val></div>
            <div class="meta-item"><label>Total Potential</label><val class="green">+$${setup.totalExpectedProfit.toFixed(2)}</val></div>
            <div class="meta-item"><label>Status</label><val>${setup.status}</val></div>
          </div>

          <table class="grid-table">
            <thead>
              <tr>
                <th>Level</th>
                <th>Entry</th>
                <th>Target</th>
                <th style="text-align:center">Status</th>
                <th style="text-align:right">Expected P&L</th>
              </tr>
            </thead>
            <tbody>
              ${levelsHtml}
              <tr class="expected-row">
                <td colspan="4" style="text-align:right; color:var(--dim)">Total Potential:</td>
                <td class="profit-col green">+$${setup.totalExpectedProfit.toFixed(2)}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    `;
    container.innerHTML += card;
  });
}

// Auto-refresh
loadData();
setInterval(loadData, 10000);
</script>

</body>
</html>
